---
title: "[论文阅读笔记 -- 频域] Learning in the Frequency Domain (CVPR 2020)"
date: 2021-06-25T15:44:51+08:00
categories: ["Paper Reading Notes"]
tags: ["paper reading", "cv", "notes", "frequency"]
draft: false
---

# Learning in the Frequency Domain (CVPR 2020)

![Fig 1](/images/2021/PRN20/1.png)

## 出发点

受计算资源与内存限制，大多数 CNN 模型只用低分辨率的 RGB 图像作为输入，处理现实中高分辨率图像时要先缩小尺寸，而这一过程难免带来信息损失。  

本文试图在频域，即离散余弦变换 (discrete cosine transform, DCT) 域中对高分辨率图像进行变形，而不是在空间域中调整尺度。将变形后的 DCT 系数传入 CNN 模型用于推断。  

## CNN 模型的频谱偏好 (Spectral Bias)

人类视觉系统 (human visual system, HVS) 对不同的频率成分敏感度不同。受这一观察结果的启发，本文在频域中分析了一系列视觉任务后发现， CNN 模型对低频通道更加敏感，而这与 HVS 是一致的，这一现象称为 CNN 模型的频谱偏好 (spectral bias)。  

CNN 模型在推断过程中可以只保留重要的频率通道，而不会造成精度损失。  

本文设计了一种静态的通道选择方法 (static channel selection approach) 来保留显著通道，而非使用整个频谱进行推断。  

![Fig 2](/images/2021/PRN20/2.png)

## 频域中的数据预处理

首先采用空域中的预处理与增广，包括尺度调整、剪裁、翻转等。  

高分辨率的 RGB 图像首先变换到 YCbCr 色彩空间，进而变换到频域 (DCT 变换)，这与如 JPEG 等广泛使用的图像压缩标准一致。处于同一频率的二维 DCT 系数被分组到同一通道，以构建三维的 DCT 立方体 (cubes)，由此生成多个频率通道。YCbCr 色彩空间中，影响较大的频率通道子集被选出，拼接形成一个张量。最终，各频率通道由从训练集计算得到的均值和方差进行规范化。  

由于 JPEG 压缩标准在 YCbCr 色彩空间上使用 \\(8 \times 8\\) DCT 变换，本文将所有 \\(8 \times 8\\) 块中属于同一频率的成分划分为一组，以维持各频率上的空间关联 (spatial relations)。  

因而 Y、Cb、Cr 成分各提供 \\(8 \times 8 = 64\\) 个通道，一个通道对应一种频率，总共 192 个频率通道。设 RGB 图像尺度为 \\(H \times W \times C\\)，则转化到频域后输入特征的尺度变成了 \\(H/8 \times W/8 \times 64C\\)，整体尺度与原输入保持不变。  

![Fig 3](/images/2021/PRN20/3.png)

### 变换到频域后模型输入层的调整

由于频域中的输入特征图通常在 H 和 W 维度上比空域更小，而在 C 维度上更大，本文跳过了传统 CNN 模型的输入层，通常是一个步数为 2 的卷积层。  

若最大值池化紧跟该卷积层 (如 ResNet-50) 则同样跳过。

进而调整接下来一层的输入尺寸，以同频域中输入的通道数相匹配。  

实际的频率通道数可在不损失精度的情况下进行精简。  

![Fig 4](/images/2021/PRN20/4.png)

## 基于学习的频率通道选择 (Learning-based Frequency Channel Selection)

设计了一种动态门控单元，赋予各频率通道一个二值分数 (binary score)。  

输入的 \\(H \times W \times C\\) 的特征 (这里 \\(C = 192\\)) 依次经由均值池化和 \\(1 \times 1\\) 卷积处理得到一个 \\(1 \times 1 \times C\\) 的张量，与 SE-Block 类似，使用面向通道的信息 (channel-wise information) 来增强有用特征并抑制无用特征。将该张量分别乘以两个可训练的参数得到一个 \\(1 \times 1 \times C \times 2\\) 的张量。

推断过程中，这两个参数被规范化，以表示被采样为 0 或 1 的几率。与输入的频率通道进行元素相乘得到最终结果。  

乘到每个通道的数是 0 或 1，通过采样一个伯努利分布 \\(Bern(p)\\) 得到，其中 \\(p\\) 由 \\(1 \times 1 \times C \times 2\\) 的张量中两数计算得到。  

门控模块的一个困境在于伯努利采样过程不可微，因而采用采用了 Gumbel Softmax trick，使得梯度能够经过离散的采样过程反响传播。  

\\(x = \\{x_{1}, x_{2}, \cdots, x_{C}\\}\\) 表示频域中的输入通道，门控模块表示为 \\(F(x_{i}) \in \\{0, 1\\}\\)，如果  

$$F(x_{i}) \ne 0, \ i.e., \ F(x_{i})\odot x_{i} \ne 0,$$  

则 \\(x_{i}\\) 被选中。  

为了平衡所选择的频率通道数目，在损失函数中加上了正则化项，与交叉熵或其他精度相关的损失一同最小化：  

$$L = L_{Acc} + \lambda \cdot \sum_{i=1}^{C} F(x_{i}).$$  

![Fig 5](/images/2021/PRN20/5.png)

## 静态频率通道选择 (Static Frequency Channel Selection)

前一节的方法对各频率通道的重要性进行动态评估，即不同的输入图像可能会有不同的频率通道子集。其目的在于支撑本节方法。  

为了理解频率通道选择 (激活) 的模式，本文生成了两张热图，一张为分类任务，一张为分割任务。各框中的数字表示通道的频率索引，索引高低代表频率高低，热图值表示某个频率通道在所有验证集图像推断过程中被选择的似然。  

由此可观察到以下一些现象：  

+ 低频通道更频繁得被选中。这表明总的来说在视觉推断任务上，低频通道能比高频通道提供更多有用信息。  
+ 亮度成分 (luma component) Y 中的频率通道比色度成分 (chroma components) Cb 和 Cr 中的更频繁被选中。这表明亮度成分在视觉推断任务中能提供更多有效信息。  
+ 分类与分割任务的热图有着共同的模式。这表明上述两点观察不仅属于某一特定任务，很可能能被推广到更多的高阶视觉任务。  
+ 有意思的是，某些低频通道比稍高频的通道更少几率被选中。  

上述现象表明 CNN 模型可能真的和 HVS 具有相似的特性，针对人眼的图像压缩标准 (如 JPEG) 可能也适用于 CNN 模型。  

JPEG 压缩标准将更多位 (bits) 放在低频与亮度成分上。按照同样的原理，本节方法静态地选取低频通道，并将重心更多放在亮度成分而非色读成分。这确保了具有更高被激活几率的频率通道被传入 CNN 模型，而其余频率通道可以被剪枝。  

## 实验结论

在 ResNet-50 上，使用所提出的通道选择方法剪枝掉 \\(87.5%\\) 的频率通道后，在 ImageNet 分类任务上不会或极少会带来精度损失。  
